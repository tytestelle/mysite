<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <style>
        /* ä¿ç•™åŸæ ·çš„æ ·å¼ */
        ul { padding: 15px; width: 350px; display: grid; row-gap: 10px; grid-template-columns: repeat(3, 1fr); }
        p { font-size: 13px; }
        body { font-family: "Microsoft YaHei"; font-weight: 300; margin: 2px;}
        button { font-size: 14.5px; padding: 0px 1px; background-color: #000; color: #fff; border: none; border-radius: 3px;}
        textarea { opacity: 0.8; font-size: 11px; white-space: pre; overflow: hidden;}
        textarea:hover { overflow: auto;}
        #linkDisplay { margin: 10px 0; padding: 8px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 4px;}
        #linkAnchor { color: #0066cc; font-weight: bold; text-decoration: none;}
        #linkAnchor:hover { text-decoration: underline;}
        .success-message { color: green; font-weight: bold; margin-bottom: 5px;}
        .copy-btn { margin-left: 10px; background: #4CAF50; color: white; border: none; border-radius: 3px; padding: 2px 6px; cursor: pointer;}
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ğŸ“ ç¼–è¾‘å·¥å…· ğŸ“</title>
</head>

<body>
    <h2>æ–‡ä»¶è½¬ä¸º <u>é“¾æ¥</u></h2>
    <p>å¯è‡ªå®šä¹‰æ‰©å±•åï¼Œè¾“å…¥å®Œæ•´æ–‡ä»¶åå¦‚ï¼š<code>log.json</code>ã€<code>test.php</code>ã€‚ã€–<a href="./search.php"><b>æ¥å£æœç´¢</b></a>ã€—</p><br>

    <form id="uploadForm">
        <div style="display: flex;">æºæ–‡ï¼š
            <span id="loadingMsg" style="display: none; color: red;">æ­£åœ¨è¯»å–ä¸­...</span>
        </div>
        <textarea name="content" id="content" rows="12" cols="44" required style="width: 96%; margin: 0;"></textarea><br><br>
        å¯†ç ï¼š
        <input type="text" name="password" id="password" required style="width: 150px;"> è¯·ç‰¢è®°ï¼ï¼<br>
        æ–‡ä»¶åï¼ˆå«æ‰©å±•åï¼‰ï¼š
        <input type="text" name="filename" id="filename" required style="width: 150px;">
        <button type="button" onclick="uploadFile()">è½¬ä¸ºé“¾æ¥</button>
    </form>

    <div id="linkDisplay" style="display: none;">
        <div class="success-message">âœ… æ–‡ä»¶å·²æˆåŠŸè½¬ä¸ºé“¾æ¥ï¼š</div>
        <a id="linkAnchor" href="" target="_blank"></a>
        <button class="copy-btn" onclick="copyLink()">å¤åˆ¶é“¾æ¥</button>
    </div>

    <script>
        async function uploadFile() {
            const filename = document.getElementById('filename').value;
            const password = document.getElementById('password').value;
            const content = document.getElementById('content').value;

            if (!filename || !password || !content) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                return;
            }

            const response = await fetch('/api/upload', {
                method: 'POST',
                body: JSON.stringify({ filename, password, content }),
                headers: { 'Content-Type': 'application/json' }
            });

            const data = await response.json();
            if (data.success) {
                document.getElementById('linkAnchor').href = data.fileLink;
                document.getElementById('linkAnchor').textContent = data.fileLink;
                document.getElementById('linkDisplay').style.display = 'block';
            } else {
                alert('ä¸Šä¼ å¤±è´¥: ' + data.error);
            }
        }

        function copyLink() {
            const link = document.getElementById('linkAnchor').href;
            navigator.clipboard.writeText(link)
                .then(() => alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'))
                .catch(err => alert('å¤åˆ¶å¤±è´¥: ' + err));
        }
    </script>
</body>
</html>
